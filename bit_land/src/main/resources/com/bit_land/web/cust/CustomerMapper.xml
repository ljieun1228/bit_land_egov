<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bit_land.web.cust.CustomerMapper">

<resultMap id="result" type="hashmap">
  <id property="customerId" column="CUST_ID" />
  <result property="customerPw" column="CUST_PW"/>
  <result property="customerName" column="CUSTOMER_NAME"/>
  <result property="address" column="ADDRESS"/>
  <result property="city" column="CITY"/>
  <result property="postalCode" column="POSTAL_CODE"/>
  <result property="ssn" column="SSN"/>
  <result property="phone" column="PHONE"/>
  <result property="gender" column="GENDER"/>
  <result property="photo" column="PHOTO"/>
  <result property="rownum" column="ROWNUM"/>
</resultMap>

 <select 
		id="selectCustomer" 
		resultMap="result">
		SELECT C.*
		FROM CUSTOMERS C
	 	WHERE CUST_ID LIKE #{customerId}
	<if test="customerPw != null">
        AND CUST_PW LIKE #{customerPw}
	</if>
	</select>
	
	<select 
		id="selectCustomers" 
		resultMap="result"
		parameterType="com.bit_land.web.cmm.Proxy">
		SELECT @ROWNUM:=@ROWNUM+1 AS ROWNUM, C.*
	    FROM CUSTOMERS C, (SELECT @ROWNUM:=0)TMP
	    ORDER BY ROWNUM DESC
	    LIMIT #{startRow}, #{pageSize}
	</select>
		
	<insert
	  id="insertCustomer"
	  parameterType="com.bit_land.web.cust.Customer"
	  flushCache="true"
	  statementType="PREPARED"
	  timeout="20">
        INSERT INTO CUSTOMERS (CUST_ID, CUSTOMER_NAME, CUST_PW, 
        					   ADDRESS, CITY, POSTAL_CODE, SSN, 
        					   GENDER, PHONE, PHOTO) 
        VALUES (#{customerId}, #{customerName},#{customerPw}, 
       			#{address}, #{city}, #{postalCode}, #{ssn}, 
       			#{gender}, #{phone}, #{photo})
	</insert>
  	
	<update
		id="updateCustomer"
		parameterType="com.bit_land.web.cust.Customer"
		flushCache="true"
		statementType="PREPARED"
		timeout="20">
		UPDATE CUSTOMERS 
		SET CUSTOMER_NAME = #{customerName},
	        ADDRESS = #{address},
	        CITY = #{city}, 
	        POSTAL_CODE = #{postalCode}, 
	        PHONE =  #{phone},
			CUST_PW = #{customerPw}
		WHERE CUST_ID =  #{customerId};
	
 	</update>

	<delete
	  	id="deleteCustomer"
	 	parameterType="com.bit_land.web.cust.Customer"
	  	flushCache="true"
	  	statementType="PREPARED"
	  	timeout="20">  
        DELETE FROM CUSTOMERS 
        WHERE CUST_ID LIKE #{customerId}
	</delete>
    
</mapper>
